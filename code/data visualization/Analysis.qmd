---
title: "Colorado Shelter Trends: Multi-Year Data Analysis"
author: "Your Name"
date: "`r Sys.Date()`"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    theme: cosmo
    number-sections: true
execute:
  echo: true
  warning: false
  message: false
---

# Introduction

-   Purpose of this analysis\
-   Data sources and time period covered\
-   Key questions:
    -   Are transfers affecting negative outcomes?
    -   Are adoptions and RTOs keeping pace with intake?
    -   Where are the biggest regional differences?

# Data Overview

## Data Description

-   Overview of data fields (intake, outcomes, transfers, etc.)
-   Data cleaning and preprocessing steps

```{r}
# Load libraries and data
library(tidyverse)
library(readxl)
library(feather)
library(here)

library(tidyverse)
library(dplyr)
library(janitor)
library(gt)
library(feather)
library(googledrive) 
library(readr)
library(readxl)

df0 <- read_feather(here("data", "data_transformed", "nkc.feather"))
```

## Summary Statistics

-   Total intakes, adoptions, and outcomes by year

```{r}
df0 %>%
  group_by(year) %>%
  summarise(
    Total_Intake = sum(total_intake, na.rm = TRUE),
    Total_Adoptions = sum(total_adoption, na.rm = TRUE),
    Total_Deaths = sum(total_death, na.rm = TRUE)
  ) %>%
  gt() %>%
  tab_header(
    title = "Shelter Outcomes by Year",
    subtitle = "Total Intake, Adoptions, and Deaths"
  ) %>%
  fmt_number(
    columns = vars(Total_Intake, Total_Adoptions, Total_Deaths),
    decimals = 0
  ) %>%
  cols_label(
    Total_Intake = "Total Intake",
    Total_Adoptions = "Total Adoptions",
    Total_Deaths = "Total Deaths"
  ) %>%
  tab_options(
    table.font.names = "Arial",
    heading.align = "center",
    table.border.top.width = 2,
    table.border.bottom.width = 2
  )
```

## Transfers vs. Negative Outcomes in Colorado Shelters

This analysis compares the number of pets transferred into Colorado shelters from other states to the number of pets who do not leave shelters alive (euthanasia, died, or missing).

**Key questions explored:**

1. Are transfers outpacing local lifesaving capacity?

2. Do increases in transfers correlate with increases in negative outcomes?

3. Are Colorado shelters absorbing regional transfers without sacrificing local pets?

By visualizing both absolute counts and percentages of total intake over time, we can better understand trends, system capacity, and the impact of transfers on shelter outcomes.


```{r}
# aggregate by year
df_yearly <- df0 %>%
  group_by(year) %>%
  summarise(
    total_transfers = sum(intake_out_of_state_transfer, na.rm = TRUE),
    total_negative = sum(negative_outcomes, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  arrange(year)

# Then calculate indexed values
df_indexed <- df_yearly %>%
  mutate(
    transfers_indexed = (total_transfers / first(total_transfers)) * 100,
    negative_indexed = (total_negative / first(total_negative)) * 100
  )

# Create the plot
ggplot(df_indexed, aes(x = year)) +
  geom_line(aes(y = transfers_indexed, color = "Transfers"), size = 1.2) +
  geom_line(aes(y = negative_indexed, color = "Negative Outcomes"), 
            size = 1.2, linetype = "dashed") +
  geom_point(aes(y = transfers_indexed, color = "Transfers"), size = 3) +
  geom_point(aes(y = negative_indexed, color = "Negative Outcomes"), size = 3) +
  scale_color_manual(values = c("Transfers" = "#2E8B57", "Negative Outcomes" = "#DC143C")) +
  labs(
    title = "Growth Trends: Transfers vs. Negative Outcomes",
    subtitle = "Indexed to First Year = 100",
    x = "Year",
    y = "Index (First Year = 100)",
    color = NULL
  ) +
  scale_x_continuous(breaks = unique(df_indexed$year)) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "top",
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5, color = "gray40")
  )
```







```{r}
# Calculate correlation
cor_value <- cor(df0$intake_out_of_state_transfer, df0$negative_outcomes, use = "complete.obs")

ggplot(df0, aes(x = intake_out_of_state_transfer, y = negative_outcomes)) +
  geom_point(aes(color = year), size = 4, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE, color = "navy", alpha = 0.2) +
  scale_color_gradient(low = "#fee5d9", high = "#a50f15") +
  labs(
    title = "Relationship Between Transfers and Negative Outcomes",
    subtitle = sprintf("Correlation: r = %.3f", cor_value),
    x = "Out-of-State Transfers",
    y = "Negative Outcomes",
    color = "Year"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5, color = "gray40")
  )

```


